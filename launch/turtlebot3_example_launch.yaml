launch:
- arg: {name: use_sim_time, default: "true"}
- include:
    if: $(var use_sim_time)
    file: "$(find-pkg-share turtlebot3_gazebo)/launch/turtlebot3_dqn_stage1.launch.py"
- include:
    unless: $(var use_sim_time)
    file: "$(find-pkg-share turtlebot3_bringup)/launch/robot.launch.py"

- node:
    if: $(var use_sim_time)
    pkg: "mouse_teleop"
    exec: "mouse_teleop"
    remap:
    - {from: "mouse_vel", to: "cmd_vel_ref"}
    param:
    - {name: "scale", value: 0.5}

- node:
    pkg: "collision_avoidance_2dl_cbf"
    exec: "collision_avoidance_2dl_cbf_node"
    remap:
    - {from: "/scan", to: "/scan"}
    - {from: "/cmd_vel_in", to: "/cmd_vel_ref"}
    - {from: "/cmd_vel_out", to: "/cmd_vel"}
    param:
    - {name: "polygon_topic_name", value: "robot_polygon"}
    - {name: "scan_topic_names", value: ["scan"]}
    - {name: "cbf_param.K", value: 0.1}
    - {name: "cbf_param.C", value: 0.1}
    - {name: "cbf_param.L", value: 0.001}
    - {name: "is_debug", value: false}

- node:
    pkg: "collision_avoidance_2dl_cbf"
    exec: "publish_collision_polygon_node"
    param:
    - {name: "base_frame_id", value: "base_link"}
    - {name: "plot_count", value: 100}
    - {name: "robot.x", value: -0.32}
    - {name: "robot.y", value: 0.0}
    - {name: "robot.r", value: 0.55}

- node:
    pkg: rviz2
    exec: rviz2
    args: "-d $(find-pkg-share collision_avoidance_2dl_cbf)/config/turtlebot3.rviz"
    param:
    - {name: "use_sim_time", value: true}
